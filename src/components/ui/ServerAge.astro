---
/**
 * Dynamic Server Age Component
 * Fetches server age based on domain or configured start date
 */
---

<div
  id="stat-years"
  class="bg-black/20 p-6 rounded-2xl border border-white/5 hover:border-[#f59e0b]/30 transition-colors text-center"
>
  <!-- Loading -->
  <div id="years-loading" class="animate-pulse">
    <div
      class="text-4xl font-black text-[#f59e0b] mb-2 drop-shadow-[0_0_10px_rgba(245,158,11,0.4)]"
    >
      --
    </div>
    <div
      class="text-sm text-gray-400 uppercase tracking-wider font-bold"
      data-i18n="about.years"
    >
    </div>
  </div>

  <!-- Content -->
  <div id="years-content" class="hidden">
    <div
      id="years-count"
      class="text-4xl font-black text-[#f59e0b] mb-2 drop-shadow-[0_0_10px_rgba(245,158,11,0.4)]"
    >
      5
    </div>
    <div
      class="text-sm text-gray-400 uppercase tracking-wider font-bold"
      data-i18n="about.years"
    >
    </div>
  </div>
</div>

<script>
  async function fetchServerAge() {
    const loadingEl = document.getElementById("years-loading");
    const contentEl = document.getElementById("years-content");
    const countEl = document.getElementById("years-count");

    try {
      const response = await fetch("/api/server-age");
      if (!response.ok) throw new Error("Failed to fetch server age");

      const data = await response.json();

      if (countEl) {
        const years = data.years;
        
        // Add a "+" if it's been partial year
        const displayYears = years >= 1 ? `${years}` : "<1";
        countEl.textContent = displayYears;
      }

      if (loadingEl) loadingEl.classList.add("hidden");
      if (contentEl) contentEl.classList.remove("hidden");
    } catch (error) {
      console.error("[ServerAge] Error:", error);
      
      // Show fallback
      if (countEl) countEl.textContent = "5";
      if (loadingEl) loadingEl.classList.add("hidden");
      if (contentEl) contentEl.classList.remove("hidden");
    }
  }

  document.addEventListener("DOMContentLoaded", () => {
    fetchServerAge();
  });
</script>
