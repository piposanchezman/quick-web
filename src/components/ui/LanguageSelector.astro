---
import type { Locale } from "../../i18n/utils";

const currentLocale = (Astro.currentLocale || 'es') as Locale;

const languages = [
    { code: "es" as Locale, name: "ES", flag: "https://flagcdn.com/w40/es.png", path: "/" },
    { code: "en" as Locale, name: "EN", flag: "https://flagcdn.com/w40/us.png", path: "/en/" },
    { code: "pt" as Locale, name: "PT", flag: "https://flagcdn.com/w40/br.png", path: "/pt/" },
];

const currentLang = languages.find(lang => lang.code === currentLocale) || languages[0];
---

<div class="relative" id="lang-selector-container">
    <button
        id="lang-selector-btn"
        class="flex items-center space-x-2 px-3 py-2 rounded-full bg-[#111111] border border-gray-700 hover:border-[#55ffff] transition-all duration-300 text-sm"
        aria-label="Cambiar idioma"
    >
        <img
            id="current-flag"
            src={currentLang.flag}
            alt={currentLang.name}
            class="w-5 h-auto rounded-sm object-cover"
        />
        <svg
            xmlns="http://www.w3.org/2000/svg"
            class="h-4 w-4 text-gray-400"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
        >
            <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M19 9l-7 7-7-7"></path>
        </svg>
    </button>

    <!-- Dropdown -->
    <div
        id="lang-dropdown"
        class="absolute right-0 mt-2 w-32 bg-[#111111] border border-gray-700 rounded-lg shadow-xl hidden z-50 overflow-hidden"
    >
        {
            languages.map((lang) => (
                <a
                    href={lang.path}
                    class="lang-option w-full flex items-center space-x-3 px-4 py-3 hover:bg-[#222222] transition-colors {lang.code === currentLocale ? 'bg-[#222222]' : ''}"
                >
                    <img
                        src={lang.flag}
                        alt={lang.name}
                        class="w-5 h-auto rounded-sm object-cover"
                    />
                    <span class="text-white text-sm font-medium">
                        {lang.name}
                    </span>
                </a>
            ))
        }
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", () => {
        const btn = document.getElementById("lang-selector-btn");
        const dropdown = document.getElementById("lang-dropdown");

        // Toggle dropdown
        btn?.addEventListener("click", (e) => {
            e.stopPropagation();
            dropdown?.classList.toggle("hidden");
        });

        // Close dropdown when clicking outside
        document.addEventListener("click", () => {
            dropdown?.classList.add("hidden");
        });
    });
</script>

<style>
    #lang-dropdown {
        animation: fadeIn 0.2s ease-out;
    }

    @keyframes fadeIn {
        from {
            opacity: 0;
            transform: translateY(-10px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
</style>
