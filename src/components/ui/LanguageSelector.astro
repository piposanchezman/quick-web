---
// Language Selector Component
const currentLang = "es"; // Default language
const languages = [
    { code: "es", name: "ES", flag: "https://flagcdn.com/w40/es.png" },
    { code: "en", name: "EN", flag: "https://flagcdn.com/w40/us.png" },
    { code: "pt", name: "PT", flag: "https://flagcdn.com/w40/br.png" },
];
---

<div class="relative" id="lang-selector-container">
    <button
        id="lang-selector-btn"
        class="flex items-center space-x-2 px-3 py-2 rounded-full bg-[#111111] border border-gray-700 hover:border-[#55ffff] transition-all duration-300 text-sm"
        aria-label="Cambiar idioma"
    >
        <img
            id="current-flag"
            src="https://flagcdn.com/w40/es.png"
            alt="Bandera"
            class="w-5 h-auto rounded-sm object-cover"
        />
        <svg
            xmlns="http://www.w3.org/2000/svg"
            class="h-4 w-4 text-gray-400"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
        >
            <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M19 9l-7 7-7-7"></path>
        </svg>
    </button>

    <!-- Dropdown -->
    <div
        id="lang-dropdown"
        class="absolute right-0 mt-2 w-32 bg-[#111111] border border-gray-700 rounded-lg shadow-xl hidden z-50 overflow-hidden"
    >
        {
            languages.map((lang) => (
                <button
                    class="lang-option w-full flex items-center space-x-3 px-4 py-3 hover:bg-[#222222] transition-colors"
                    data-lang={lang.code}
                    data-flag={lang.flag}
                    data-name={lang.name}
                >
                    <img
                        src={lang.flag}
                        alt={lang.name}
                        class="w-5 h-auto rounded-sm object-cover"
                    />
                    <span class="text-white text-sm font-medium">
                        {lang.name}
                    </span>
                </button>
            ))
        }
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", () => {
        const btn = document.getElementById("lang-selector-btn");
        const dropdown = document.getElementById("lang-dropdown");
        const currentFlag = document.getElementById("current-flag"); // HTMLImageElement
        const langOptions = document.querySelectorAll(".lang-option");

        // Load saved language
        const savedLang = localStorage.getItem("quickland-lang") || "es";
        const savedOption = document.querySelector(
            `[data-lang="${savedLang}"]`,
        );
        if (savedOption && currentFlag instanceof HTMLImageElement) {
            currentFlag.src =
                savedOption.getAttribute("data-flag") ||
                "https://flagcdn.com/w40/es.png";
        }

        // Toggle dropdown
        btn?.addEventListener("click", (e) => {
            e.stopPropagation();
            dropdown?.classList.toggle("hidden");
        });

        // Close dropdown when clicking outside
        document.addEventListener("click", () => {
            dropdown?.classList.add("hidden");
        });

        // Handle language selection
        langOptions.forEach((option) => {
            option.addEventListener("click", () => {
                const lang = option.getAttribute("data-lang");
                const flagSrc = option.getAttribute("data-flag");
                const name = option.getAttribute("data-name");

                if (currentFlag instanceof HTMLImageElement) {
                    currentFlag.src =
                        flagSrc || "https://flagcdn.com/w40/es.png";
                }

                // Save preference
                localStorage.setItem("quickland-lang", lang || "es");

                // Close dropdown
                dropdown?.classList.add("hidden");

                // Dispatch custom event for language change
                window.dispatchEvent(
                    new CustomEvent("languageChange", { detail: { lang } }),
                );

                console.log(`Idioma cambiado a: ${name}`);
            });
        });
    });
</script>

<style>
    #lang-dropdown {
        animation: fadeIn 0.2s ease-out;
    }

    @keyframes fadeIn {
        from {
            opacity: 0;
            transform: translateY(-10px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
</style>
